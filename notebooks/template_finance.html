
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>APIs &#8212; Mathematics</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      <h1 class="site-logo" id="site-title">Mathematics</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Thank you for visiting!
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Foundations
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../nbs/Sets.html">
   Sets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../nbs/ComplexNumbers.html">
   Complex Numbers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../nbs/NumberTheory.html">
   Number Theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../nbs/AlgorithmicNumberTheory.html">
   Algorithmic Number Theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../nbs/ModularArithmetic.html">
   Modular Arithmetic
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../nbs/Polynomials.html">
   Polynomials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../nbs/ConicSections.html">
   Conic Sections
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../nbs/Structures.html">
   Structures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../nbs/Groups.html">
   Groups
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../nbs/Fields.html">
   Fields
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../nbs/LinearAlgebra.html">
   Linear Algebra
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Modeling
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../nbs/RandomWalks.html">
   Random Walks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../nbs/DigitalSignalProcessing.html">
   Digital Signal Processing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../nbs/DifferentialEquations.html">
   Differential Equations
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Blockchain
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../nbs/PythonBlockchain.html">
   Python Blockchain
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/template_finance.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/davefriedman01/Resources"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/davefriedman01/Resources/master?urlpath=tree/docs/notebooks/template_finance.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   APIs
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#helper-functions">
   Helper Functions
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stochastics-hilpisch-s-python-for-finance">
   12. Stochastics (Hilpisch’s
   <em>
    Python for Finance
   </em>
   )
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#black-scholes-merton-model-for-options-pricing">
   Black-Scholes-Merton Model for Options Pricing
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#static-representation">
     Static Representation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dynamic-representation">
     Dynamic Representation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#square-root-diffusion">
       Square-Root Diffusion
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stochastic-volatility-models">
       Stochastic Volatility Models
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#jump-diffusion">
       Jump Diffusion
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#variance-reduction">
       Variance Reduction
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#valuation-of-contingent-claims-options-derivatives-hybrid-instruments">
       Valuation of Contingent Claims (options, derivatives, hybrid instruments)
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stochastic-processes">
   Stochastic Processes
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#probability-distirbution-functions">
   Probability Distirbution Functions
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#python-for-algorithmic-trading">
   Python for Algorithmic Trading
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">numpy.random</span> <span class="k">as</span> <span class="nn">npr</span>
<span class="kn">import</span> <span class="nn">numpy_financial</span> <span class="k">as</span> <span class="nn">npf</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pandas_datareader</span> <span class="k">as</span> <span class="nn">pdr</span>

<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">scs</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="n">mpl</span><span class="p">,</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn&#39;</span><span class="p">)</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

<span class="kn">import</span>\
    <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span><span class="o">,</span>\
    <span class="n">json</span><span class="p">,</span>\
    <span class="n">math</span><span class="p">,</span>\
    <span class="n">requests</span><span class="p">,</span>\
    <span class="n">threading</span><span class="p">,</span>\
    <span class="n">time</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">panel</span> <span class="k">as</span> <span class="nn">pn</span>
<span class="n">pn</span><span class="o">.</span><span class="n">extension</span><span class="p">(</span><span class="s1">&#39;plotly&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>



<span class="kn">import</span> <span class="nn">yfinance</span> <span class="k">as</span> <span class="nn">yf</span>

<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">find_dotenv</span><span class="p">,</span> <span class="n">get_key</span>

<span class="kn">import</span> <span class="nn">quandl</span>
<span class="n">quandl</span><span class="o">.</span><span class="n">ApiConfig</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">get_key</span><span class="p">(</span><span class="n">find_dotenv</span><span class="p">(),</span> <span class="s1">&#39;QUANDL_API_KEY&#39;</span><span class="p">)</span>

<span class="n">API_KEY</span> <span class="o">=</span> <span class="n">get_key</span><span class="p">(</span><span class="n">find_dotenv</span><span class="p">(),</span> <span class="s1">&#39;ALPACA_API_KEY&#39;</span><span class="p">)</span>
<span class="n">API_SECRET</span> <span class="o">=</span> <span class="n">get_key</span><span class="p">(</span><span class="n">find_dotenv</span><span class="p">(),</span> <span class="s1">&#39;ALPACA_SECRET_KEY&#39;</span><span class="p">)</span>
<span class="n">APCA_API_BASE_URL</span> <span class="o">=</span> <span class="s1">&#39;https://paper-api.alpaca.markets&#39;</span>
<span class="kn">import</span> <span class="nn">alpaca_trade_api</span> <span class="k">as</span> <span class="nn">tradeapi</span>
<span class="kn">from</span> <span class="nn">alpaca_trade_api.rest</span> <span class="kn">import</span> <span class="n">REST</span><span class="p">,</span> <span class="n">TimeFrame</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">REST</span><span class="p">(</span>
    <span class="n">API_KEY</span><span class="p">,</span>
    <span class="n">API_SECRET</span><span class="p">,</span>
    <span class="n">api_version</span><span class="o">=</span><span class="s1">&#39;v2&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="apis">
<h1>APIs<a class="headerlink" href="#apis" title="Permalink to this headline">¶</a></h1>
<p>Alpaca API<br>
Quandl API<br>
Yahoo Finance API <a class="reference external" href="https://github.com/ranaroussi/yfinance">GitHub</a> <a class="reference external" href="https://pypi.org/project/yfinance/">PyPI</a><br></p>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sym</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">Ticker</span><span class="p">(</span><span class="s1">&#39;QQQ&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="helper-functions">
<h1>Helper Functions<a class="headerlink" href="#helper-functions" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_statistics</span> <span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Prints selected statistics (on top of scipy.stats).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    a1, a2: ndarray objects</span>
<span class="sd">        results objects from simulation</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">sta1</span> <span class="o">=</span> <span class="n">scs</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
    <span class="n">sta2</span> <span class="o">=</span> <span class="n">scs</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14s</span><span class="s1"> </span><span class="si">%14s</span><span class="s1"> </span><span class="si">%14s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;statistic&#39;</span><span class="p">,</span> <span class="s1">&#39;data set 1&#39;</span><span class="p">,</span> <span class="s1">&#39;data set 2&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="mi">45</span> <span class="o">*</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14s</span><span class="s1"> </span><span class="si">%14.3f</span><span class="s1"> </span><span class="si">%14.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="n">sta1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sta2</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14s</span><span class="s1"> </span><span class="si">%14.3f</span><span class="s1"> </span><span class="si">%14.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">sta1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">sta2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14s</span><span class="s1"> </span><span class="si">%14.3f</span><span class="s1"> </span><span class="si">%14.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">sta1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">sta2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14s</span><span class="s1"> </span><span class="si">%14.3f</span><span class="s1"> </span><span class="si">%14.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">sta1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sta2</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14s</span><span class="s1"> </span><span class="si">%14.3f</span><span class="s1"> </span><span class="si">%14.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sta1</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sta2</span><span class="p">[</span><span class="mi">3</span><span class="p">])))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14s</span><span class="s1"> </span><span class="si">%14.3f</span><span class="s1"> </span><span class="si">%14.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;skew&#39;</span><span class="p">,</span> <span class="n">sta1</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">sta2</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14s</span><span class="s1"> </span><span class="si">%14.3f</span><span class="s1"> </span><span class="si">%14.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;kurtosis&#39;</span><span class="p">,</span> <span class="n">sta1</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">sta2</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
    
<span class="k">def</span> <span class="nf">gen_sn</span> <span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">anti_paths</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mo_match</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Function to generate random numbers for simulation.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    M: int</span>
<span class="sd">        number of time intervals for discretization</span>
<span class="sd">    I: int</span>
<span class="sd">        number of paths to be simulated</span>
<span class="sd">    anti_paths: boolean</span>
<span class="sd">        use of antithetic variates</span>
<span class="sd">    mo_match: boolean</span>
<span class="sd">        use of moment matching</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">anti_paths</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">sn</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">((</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">I</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="n">sn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">sn</span><span class="p">,</span> <span class="o">-</span><span class="n">sn</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sn</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">((</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">I</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">mo_match</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">sn</span> <span class="o">=</span> <span class="p">(</span><span class="n">sn</span> <span class="o">-</span> <span class="n">sn</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">sn</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">sn</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="stochastics-hilpisch-s-python-for-finance">
<h1>12. Stochastics (Hilpisch’s <em>Python for Finance</em>)<a class="headerlink" href="#stochastics-hilpisch-s-python-for-finance" title="Permalink to this headline">¶</a></h1>
<p>Pseudo Random Numbers<br>
Quasi Random Numbers based on Sobol sequences<br>
Simulation of Random Variables<br>
Simulation of Stochastic Processes<br></p>
<p>Valuation of derivatives with European exercise<br>
Valuation of derivatives with American exercise<br>
Valuation of derivatives with Bermudan exercise<br></p>
<p>Risk Analysis<br>
VaR Value at Risk
<a class="reference external" href="https://www.investopedia.com/articles/04/092904.asp">Investopedia Part 1</a>
<a class="reference external" href="https://www.investopedia.com/articles/04/101304.asp">Investopedia Part 2</a><br>
Credit VaR<br>
Credit valuation adjustment<br></p>
<p>(standard) normal distributions in finance are criticised, but many financial models rest directly on a (log-)normal distribution assumption; other models that don’t can be Euler-discretized and approximated for the purposes of simulation by means of the normal distribution<br>
The Euler discretization scheme is exact for the geometric Brownian motion, but it is biased for the majority of other stochastic processes. Even if there is an exact scheme available, the use of an Euler scheme might be desirable for numerical and/or computational reasons.<br></p>
<p>MCS Monte Carlo Simulation<br>
a numerical method for the evaluation of mathematical expressions like integrals and the valuation of financial derivatives<br>
high computational cost: millions of computations per value estimate<br></p>
</div>
<hr class="docutils" />
<div class="section" id="black-scholes-merton-model-for-options-pricing">
<h1>Black-Scholes-Merton Model for Options Pricing<a class="headerlink" href="#black-scholes-merton-model-for-options-pricing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="static-representation">
<h2>Static Representation<a class="headerlink" href="#static-representation" title="Permalink to this headline">¶</a></h2>
<div class="math notranslate nohighlight">
\[S_T = S_0 \, \text{exp}\left[\left(r - \frac{1}{2}\sigma^2\right)T + \sigma\sqrt{T}z\right]\]</div>
<p><span class="math notranslate nohighlight">\(S_T\)</span> stock index level at a future date <span class="math notranslate nohighlight">\(T\)</span> <br>
<span class="math notranslate nohighlight">\(S_0\)</span> the level of a stock index today <br>
<span class="math notranslate nohighlight">\(r\)</span> constant riskless short rate <br>
<span class="math notranslate nohighlight">\(\sigma\)</span> constant volatility (standard deviation of returns) of <span class="math notranslate nohighlight">\(S\)</span>; a major simplifying assumption is that volatility is constant <br>
<span class="math notranslate nohighlight">\(z\)</span> standard normal random variable <br></p>
</div>
<div class="section" id="dynamic-representation">
<h2>Dynamic Representation<a class="headerlink" href="#dynamic-representation" title="Permalink to this headline">¶</a></h2>
<p>Black-Scholes-Merton SDE (geometric Brownian motion)<br>
$<span class="math notranslate nohighlight">\(d S_t = r S_t dt + \sigma S_t d Z_t\)</span><span class="math notranslate nohighlight">\(
\)</span>S_t<span class="math notranslate nohighlight">\( the value of the underlying at time \)</span>t<span class="math notranslate nohighlight">\(; the values of \)</span>S_t<span class="math notranslate nohighlight">\( are log-normally distributed&lt;br&gt;
\)</span>\frac{dS_t}{S_t}<span class="math notranslate nohighlight">\( the marginal returns are normally distributed&lt;br&gt;
\)</span>r<span class="math notranslate nohighlight">\( the constant, riskless short rate&lt;br&gt;
\)</span>\sigma<span class="math notranslate nohighlight">\( the constant instantaneous volatility&lt;br&gt;
\)</span>Z_t$ a standard Brownian motion<br></p>
<hr class="docutils" />
<p>Black-Scholes-Merton difference equation (exactly-discretized Euler scheme)<br>
$<span class="math notranslate nohighlight">\(S_t = S_{t - \Delta t} \text{exp} \left( \left( r - \frac{\sigma^2}{2} \right) \Delta t + \sigma\sqrt{\Delta t} z \right)\)</span><span class="math notranslate nohighlight">\(
\)</span>\Delta t<span class="math notranslate nohighlight">\( the fixed discretization interval&lt;br&gt;
\)</span>z_t<span class="math notranslate nohighlight">\( a standard normally distributed random variable&lt;br&gt;
for \)</span>M<span class="math notranslate nohighlight">\( time intervals, the length of the time interval is given as \)</span>\Delta t \equiv \frac{T}{M}<span class="math notranslate nohighlight">\( where \)</span>T$ is the time horizon for the simulation<br></p>
<p>the resulting end values for the index level are log-normally distributed<br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># BSM Static Simulation</span>

<span class="n">S0</span>    <span class="o">=</span> <span class="mi">100</span>                  <span class="c1"># the initial index level</span>
<span class="n">r</span>     <span class="o">=</span> <span class="mf">0.05</span>                 <span class="c1"># the constant riskless short rate</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.25</span>                 <span class="c1"># the constant volatility factor</span>
<span class="n">T</span>     <span class="o">=</span> <span class="mf">2.0</span>                  <span class="c1"># the horizon in year fractions</span>
<span class="n">I</span>     <span class="o">=</span> <span class="mi">10_000</span>               <span class="c1"># the number of simulations</span>

<span class="n">M</span>     <span class="o">=</span> <span class="mi">50</span>                   <span class="c1"># the number of time intervals for the discretization</span>
<span class="n">dt</span>    <span class="o">=</span> <span class="n">T</span> <span class="o">/</span> <span class="n">M</span>                <span class="c1"># the length of the time interval in year fractions</span>
<span class="n">S</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">I</span><span class="p">))</span> <span class="c1"># the 2D ndarray for the index levels</span>
<span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">S0</span>                   <span class="c1"># the initial index level</span>

<span class="c1"># discretized simulation via vectorized expression</span>
<span class="c1"># normally distributed</span>
<span class="n">ST1</span>   <span class="o">=</span> <span class="n">S0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">npr</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
<span class="c1"># log normally distributed</span>
<span class="n">ST2</span>   <span class="o">=</span> <span class="n">S0</span> <span class="o">*</span> <span class="n">npr</span><span class="o">.</span><span class="n">lognormal</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">I</span><span class="p">)</span>

<span class="n">print_statistics</span><span class="p">(</span><span class="n">ST1</span><span class="p">,</span> <span class="n">ST2</span><span class="p">)</span>
<span class="c1"># the statistics of both simulation results are quite similar</span>
<span class="c1"># the differences are primarily due to the simulation sampling error</span>
<span class="c1"># the discretization error, which is due to discretely simulating continuous stochastic processes,</span>
<span class="c1">#   is not a factor here because the simulation is generated statically</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ST1</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;index level&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Statically simulated geometric Brownian motion (via npr.standard_normal())&#39;</span><span class="p">);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ST2</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;index level&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Statically simulated geometric Brownian motion (via npr.lognormal())&#39;</span><span class="p">);</span>

<span class="c1"># BSM Dynamic Simulation</span>
<span class="c1">#   the dynamic simulation allows us to</span>
<span class="c1">#     visualize paths</span>
<span class="c1">#     value options with American or Bermudan exercise, or options whose payoff is path-dependent</span>

<span class="c1"># discretized simulation via semi vectorized expression</span>
<span class="c1">#   the loop is over the points in time starting at t = 1 and ending at t = T</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">S</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="o">*</span> <span class="n">npr</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
    
<span class="n">print_statistics</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ST2</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;index level&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Dynamically simulated geometric Brownian motion at maturity&#39;</span><span class="p">);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">S</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;index level&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Dynamically simulated geometric Brownian motion paths&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     statistic     data set 1     data set 2
---------------------------------------------
          size      10000.000      10000.000
           min         20.215         24.339
           max        392.058        392.235
          mean        109.949        111.138
           std         40.095         40.174
          skew          1.119          1.090
      kurtosis          2.197          2.025
     statistic     data set 1     data set 2
---------------------------------------------
          size      10000.000      10000.000
           min         31.039         24.339
           max        369.806        392.235
          mean        110.628        111.138
           std         39.971         40.174
          skew          1.083          1.090
      kurtosis          1.960          2.025
</pre></div>
</div>
<img alt="../_images/template_finance_16_1.png" src="../_images/template_finance_16_1.png" />
<img alt="../_images/template_finance_16_2.png" src="../_images/template_finance_16_2.png" />
<img alt="../_images/template_finance_16_3.png" src="../_images/template_finance_16_3.png" />
<img alt="../_images/template_finance_16_4.png" src="../_images/template_finance_16_4.png" />
</div>
</div>
<hr class="docutils" />
<div class="section" id="square-root-diffusion">
<h3>Square-Root Diffusion<a class="headerlink" href="#square-root-diffusion" title="Permalink to this headline">¶</a></h3>
<p>Cox, Ingersoll, &amp; Ross (1985)<br></p>
<p><strong>Mean-Reverting Process</strong><br>
an important class of financial processes which are used to model short rates or volatility processes, for example<br></p>
<p><strong>Square-Root Diffusion SDE</strong><br>
$<span class="math notranslate nohighlight">\(
dx_t = \kappa (\theta - x_t) dt + \sigma \sqrt{x_t} dZ_t
\)</span><span class="math notranslate nohighlight">\(
\)</span>x_t<span class="math notranslate nohighlight">\( the process level at date t; the values of \)</span>x_t<span class="math notranslate nohighlight">\( are chi-squared distributed and remain strictly positive&lt;br&gt;
\)</span>\kappa<span class="math notranslate nohighlight">\( the mean-reversion factor&lt;br&gt;
\)</span>\theta<span class="math notranslate nohighlight">\( the long-term mean of the process&lt;br&gt;
\)</span>\sigma<span class="math notranslate nohighlight">\( the constant volatility factor&lt;br&gt;
\)</span>Z_t$ a standard Brownian motion<br></p>
<p><strong>Fully-Truncated Euler Discretization for Square-Root Diffusion</strong><br>
$<span class="math notranslate nohighlight">\(
\begin{align}
\tilde{x}_t &amp;= \tilde{x}_s + \kappa (\theta - \tilde{x}^+_s) \Delta t + \sigma \sqrt{\tilde{x}^+_s} \sqrt{\Delta t} z_t \\
x_t &amp;= \tilde{x}^+_t \\
\end{align}
\)</span><span class="math notranslate nohighlight">\(
\)</span>s = t - \Delta t<span class="math notranslate nohighlight">\(&lt;br&gt;
\)</span>x^+ \equiv \text{max}(x, 0)$<br>
correlation is easily and consistently account for since one only draws standard normally distributed random numbers<br></p>
<p><strong>Exact Non Central Chi-Square Distribution Discretization for Square-Root Diffusion</strong><br>
$<span class="math notranslate nohighlight">\(
x_t = \frac{\sigma^2 (1 - e^{- \kappa \Delta t})}{4 \kappa} \chi^{'2}_d \text{nc}
\)</span><span class="math notranslate nohighlight">\(
noncentral chi-square distribution \)</span>\chi^{‘2}_d<span class="math notranslate nohighlight">\(&lt;br&gt;
degrees of freedom \)</span>\text{df} = \frac{4 \theta \kappa}{\sigma^2}<span class="math notranslate nohighlight">\(&lt;br&gt;
noncentrality parameter \)</span>\text{nc} = \frac{4 \kappa e^{- \kappa \Delta t}}{\sigma^2 (1 - e^{- \kappa \Delta t})} x_s$<br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Square-Root Diffusion simulation</span>

<span class="n">x0</span>    <span class="o">=</span> <span class="mf">0.05</span>   <span class="c1"># the initial value (e.g., for a short rate)</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mf">3.0</span>    <span class="c1"># the mean-reversion factor</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mf">0.02</span>   <span class="c1"># the long-term mean</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.1</span>    <span class="c1"># the constant volatility factor</span>
<span class="n">I</span>     <span class="o">=</span> <span class="mi">250_000</span> <span class="c1"># the number of path simulations</span>
<span class="n">T</span>     <span class="o">=</span> <span class="mf">2.0</span>    <span class="c1"># the horizon in year fractions</span>
<span class="n">M</span>     <span class="o">=</span> <span class="mi">50</span>     <span class="c1"># the number of time intervals for the discretization</span>
<span class="n">dt</span>    <span class="o">=</span> <span class="n">T</span> <span class="o">/</span> <span class="n">M</span>  <span class="c1"># the length of the time interval in year fractions</span>

<span class="c1"># Euler discretization scheme via npr.standard_normal()</span>
<span class="c1">#   negative average drift due to x0 &gt; 0</span>
<span class="c1">#   convergence to theta = 0.02</span>
<span class="k">def</span> <span class="nf">srd_euler</span> <span class="p">():</span>
    <span class="n">xh</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">I</span><span class="p">))</span>
    <span class="n">x</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">xh</span><span class="p">)</span>
    <span class="n">xh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">x0</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">xh</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">xh</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                 <span class="n">kappa</span> <span class="o">*</span> <span class="p">(</span><span class="n">theta</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">xh</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span>
                 <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">xh</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">))</span> <span class="o">*</span>
                 <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="o">*</span> <span class="n">npr</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">xh</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="c1"># exact discretization scheme via npr.noncentral_chisquare()</span>
<span class="k">def</span> <span class="nf">srd_exact</span> <span class="p">():</span>
    <span class="n">x</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">I</span><span class="p">))</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>     <span class="o">=</span> <span class="n">x0</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">df</span>   <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">theta</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">/</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">c</span>    <span class="o">=</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">kappa</span><span class="p">)</span>
        <span class="n">nc</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">npr</span><span class="o">.</span><span class="n">noncentral_chisquare</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">I</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="o">%</span><span class="k">time</span> x1 = srd_euler()
<span class="o">%</span><span class="k">time</span> x2 = srd_exact()

<span class="n">print_statistics</span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># performance: statistical properties</span>
<span class="c1">#   the biased Euler scheme performs quite well when it comes to the desired statistical properties</span>
<span class="c1"># performance: computational efficiency</span>
<span class="c1">#   sampling from the noncentral chi-square distribution is more computationally demanding</span>
<span class="c1">#   than from the standard normal distribution</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Dynamically simulated square-root diffusion at maturity (Euler scheme)&#39;</span><span class="p">);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;index level&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Dynamically simulated square-root diffusion paths (Euler scheme)&#39;</span><span class="p">);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Dynamically simulated square-root diffusion at maturity (exact scheme)&#39;</span><span class="p">);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;index level&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Dynamically simulated square-root diffusion paths (exact scheme)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 540 ms, sys: 81.5 ms, total: 621 ms
Wall time: 625 ms
CPU times: user 1.11 s, sys: 13.7 ms, total: 1.13 s
Wall time: 1.13 s
     statistic     data set 1     data set 2
---------------------------------------------
          size     250000.000     250000.000
           min          0.003          0.004
           max          0.059          0.060
          mean          0.020          0.020
           std          0.006          0.006
          skew          0.556          0.585
      kurtosis          0.454          0.523
</pre></div>
</div>
<img alt="../_images/template_finance_19_1.png" src="../_images/template_finance_19_1.png" />
<img alt="../_images/template_finance_19_2.png" src="../_images/template_finance_19_2.png" />
<img alt="../_images/template_finance_19_3.png" src="../_images/template_finance_19_3.png" />
<img alt="../_images/template_finance_19_4.png" src="../_images/template_finance_19_4.png" />
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="stochastic-volatility-models">
<h3>Stochastic Volatility Models<a class="headerlink" href="#stochastic-volatility-models" title="Permalink to this headline">¶</a></h3>
<p>early 1990s<br></p>
<p><strong>Heston (1993) Stochastic Volatility SDE</strong><br>
$<span class="math notranslate nohighlight">\(
\begin{align}
dS_t &amp;= r S_t dt + \sqrt{v_t} S_t dZ^1_t \\
dv_t &amp;= \kappa_v (\theta_v - v_t) dt + \sigma_v \sqrt{v_t} dZ^2_t \\
dZ^1_t dZ^2_t &amp;= \rho \\
\end{align}
\)</span><span class="math notranslate nohighlight">\(
\)</span>\rho<span class="math notranslate nohighlight">\( the instantaneous correlation between the two standard Brownian motions \)</span>dZ^1_t<span class="math notranslate nohighlight">\(, \)</span>dZ^2_t$ accounts for a stylized fact called the <em>leverage effect</em> which states that volatility goes up in times of stress (declining markets) and goes down in times of a bull market (rising markets)<br>
to account for the correlation between the two stochastic processes, one needs to determine the Cholesky decomposition of the correlation matrix<br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">S0</span>    <span class="o">=</span> <span class="mi">100</span>
<span class="n">r</span>     <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">v0</span>    <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># initial instantaneous volatility value</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">rho</span>   <span class="o">=</span> <span class="mf">0.6</span>  <span class="c1"># fixed correlation between two Brownian motions</span>
<span class="n">T</span>     <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">M</span>     <span class="o">=</span> <span class="mi">50</span>
<span class="n">I</span>     <span class="o">=</span> <span class="mi">10_000</span>
<span class="n">dt</span>    <span class="o">=</span> <span class="n">T</span> <span class="o">/</span> <span class="n">M</span>

<span class="n">corr_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">corr_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">rho</span><span class="p">]</span>
<span class="n">corr_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">rho</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">cho_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">corr_mat</span><span class="p">)</span> <span class="c1"># Cholesky decomposition</span>

<span class="c1"># generate 3D random numbers</span>
<span class="c1">#   use set 0 for the index process</span>
<span class="c1">#   use set 1 for the volatility process</span>
<span class="n">ran_num</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">I</span><span class="p">))</span>

<span class="c1"># volatility process simulation</span>
<span class="c1">#   biased Euler scheme for square-root diffusion</span>
<span class="n">v</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ran_num</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">vh</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="o">=</span> <span class="n">v0</span>
<span class="n">vh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   <span class="o">=</span> <span class="n">v0</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="c1"># select the relevant random number subset and transform it via the Cholesky matrix</span>
    <span class="n">ran</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cho_mat</span><span class="p">,</span> <span class="n">ran_num</span><span class="p">[:,</span> <span class="n">t</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">vh</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vh</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
             <span class="n">kappa</span> <span class="o">*</span> <span class="p">(</span><span class="n">theta</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">vh</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span>
             <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">vh</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">))</span> <span class="o">*</span>
             <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="o">*</span> <span class="n">ran</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">vh</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># index level process simulation</span>
<span class="c1">#   exact Euler scheme for geometric Brownian motion</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ran_num</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">S0</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="c1"># select the relevant random number subset and transform it via the Cholesky matrix</span>
    <span class="n">ran</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cho_mat</span><span class="p">,</span> <span class="n">ran_num</span><span class="p">[:,</span> <span class="n">t</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">S</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="o">*</span> <span class="n">ran</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
    
<span class="n">print_statistics</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;index level&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;volatility&#39;</span><span class="p">);</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Dynamically simulated stochastic volatility process at maturity&#39;</span><span class="p">);</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">S</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;index level&#39;</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;volatility&#39;</span><span class="p">);</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Dynamically simulated stochastic volatility process paths&#39;</span><span class="p">);</span>

<span class="c1"># the volatility process is drifting positively on average and converges to theta = 0.25</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     statistic     data set 1     data set 2
---------------------------------------------
          size      10000.000      10000.000
           min         20.048          0.171
           max        562.190          0.335
          mean        108.279          0.243
           std         51.834          0.020
          skew          1.702          0.138
      kurtosis          5.404          0.128
</pre></div>
</div>
<img alt="../_images/template_finance_22_1.png" src="../_images/template_finance_22_1.png" />
<img alt="../_images/template_finance_22_2.png" src="../_images/template_finance_22_2.png" />
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="jump-diffusion">
<h3>Jump Diffusion<a class="headerlink" href="#jump-diffusion" title="Permalink to this headline">¶</a></h3>
<p>Merton’s 1976 Jump Diffusion Model enhances the BSM setup through a model component generating jumps with log-normal distribution<br>
an important stylized/empirial fact is the existence of jumps in asset prices and volatility, for example<br></p>
<p><strong>Merton Risk-Neutral Jump Diffusion SDE</strong><br>
$<span class="math notranslate nohighlight">\(
dS_t = (r - r_j) S_t dt + \sigma S_t dZ_t + J_t S_t dN_t
\)</span><span class="math notranslate nohighlight">\(
\)</span>S_t<span class="math notranslate nohighlight">\( index level at date \)</span>t<span class="math notranslate nohighlight">\(&lt;br&gt;
\)</span>r<span class="math notranslate nohighlight">\( constant riskless short rate&lt;br&gt;
\)</span>r_j \equiv \lambda \cdot (e^{\mu_j + \delta^2 / 2} - 1)<span class="math notranslate nohighlight">\( the drift correction for jump to maintain risk neutrality&lt;br&gt;
\)</span>\sigma<span class="math notranslate nohighlight">\( the constant volatility of \)</span>S<span class="math notranslate nohighlight">\(&lt;br&gt;
\)</span>Z_t<span class="math notranslate nohighlight">\( a standard Brownian motion&lt;br&gt;
\)</span>J_t<span class="math notranslate nohighlight">\( the jump at date \)</span>t<span class="math notranslate nohighlight">\( with distribution \)</span>\text{log}(1 + J_t) \approx \textbf{N} \left( \text{log}(1 + \mu_j) - \frac{\delta^2}{2}, \delta^2 \right)<span class="math notranslate nohighlight">\( with \)</span>\textbf{N}<span class="math notranslate nohighlight">\( as the cumulative distribution function of a standard normal random variable&lt;br&gt;
\)</span>N_t<span class="math notranslate nohighlight">\( a Poisson process with intensity \)</span>\lambda$<br></p>
<p><strong>Euler Discretization for Merton Risk-Neutral Jump Diffusion</strong><br>
$<span class="math notranslate nohighlight">\(
S_t = S_{t - \Delta t} \left( e^{(r - r_j - \sigma^2 / 2) \Delta t + \sigma \sqrt{\Delta t} z^1_t} + (e^{\mu_j + \delta z^2_t} - 1) y_t \right)
\)</span><span class="math notranslate nohighlight">\(
\)</span>z^n_t<span class="math notranslate nohighlight">\( are standard normally distributed&lt;br&gt;
\)</span>y_t<span class="math notranslate nohighlight">\( are Poisson distributed with intensity \)</span>\lambda$<br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">S0</span>    <span class="o">=</span> <span class="mi">100</span>
<span class="n">r</span>     <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">lamb</span>  <span class="o">=</span> <span class="mf">0.75</span>                                       <span class="c1"># the jump intensity</span>
<span class="n">mu</span>    <span class="o">=</span> <span class="o">-</span><span class="mf">0.6</span>                                       <span class="c1"># the mean jump size</span>
<span class="n">delta</span> <span class="o">=</span> <span class="mf">0.25</span>                                       <span class="c1"># the jump volatility</span>
<span class="n">rj</span>    <span class="o">=</span> <span class="n">lamb</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mu</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">delta</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># the drift correction</span>
<span class="n">T</span>     <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">M</span>     <span class="o">=</span> <span class="mi">50</span>
<span class="n">I</span>     <span class="o">=</span> <span class="mi">10_000</span>
<span class="n">dt</span>    <span class="o">=</span> <span class="n">T</span> <span class="o">/</span> <span class="n">M</span>

<span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">I</span><span class="p">))</span>
<span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">S0</span>
<span class="n">sn1</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">((</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">I</span><span class="p">))</span>    <span class="c1"># standard normally distributed random numbers</span>
<span class="n">sn2</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">((</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">I</span><span class="p">))</span>    <span class="c1"># standard normally distributed random numbers</span>
<span class="n">poi</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">lamb</span> <span class="o">*</span> <span class="n">dt</span><span class="p">,</span> <span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">I</span><span class="p">))</span> <span class="c1"># Poisson distributed random numbers</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">S</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="n">rj</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span>
                       <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="o">*</span> <span class="n">sn1</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="o">+</span>
                       <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mu</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">sn2</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span>
                       <span class="n">poi</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
    <span class="n">S</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Dynamically simulated jump diffusion process at maturity&#39;</span><span class="p">);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">S</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;index level&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Dynamically simulated jump diffusion process paths&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/template_finance_25_0.png" src="../_images/template_finance_25_0.png" />
<img alt="../_images/template_finance_25_1.png" src="../_images/template_finance_25_1.png" />
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="variance-reduction">
<h3>Variance Reduction<a class="headerlink" href="#variance-reduction" title="Permalink to this headline">¶</a></h3>
<p>improve the matching of the first two moments of the (standard) normal distribution<br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%15s</span><span class="s1"> </span><span class="si">%15s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;Mean&#39;</span><span class="p">,</span> <span class="s1">&#39;Std. Deviation&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="mi">31</span> <span class="o">*</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">npr</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">sn</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">i</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">10_000</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%15.12f</span><span class="s1"> </span><span class="si">%15.12f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sn</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">sn</span><span class="o">.</span><span class="n">std</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           Mean  Std. Deviation
-------------------------------
 0.001150944833  1.006296354600
 0.002841204001  0.995987967146
 0.001998082016  0.997701714233
 0.001322322067  0.997771186968
 0.000592711311  0.998388962646
-0.000339730751  0.998399891450
-0.000228109010  0.998657429396
 0.000295768719  0.998877333340
 0.000257107789  0.999284894532
-0.000357870642  0.999456401088
-0.000528443742  0.999617831131
-0.000300171536  0.999445228838
-0.000162924037  0.999516059328
 0.000135778889  0.999611052522
 0.000182006048  0.999619405229
</pre></div>
</div>
</div>
</div>
<p><strong>Antithetic Variates</strong><br>
corrects the first moment, but not the second moment<br>
this approach draws only half the desired number of random draws and adds the same set of random numbers with the opposite sign afterward (i.e., if the random number generator draws 0.5, then another number with value -0.5 is added to the set). by construction, the mean value of such a data set must equal zero<br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sn</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">10_000</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">sn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">sn</span><span class="p">,</span> <span class="o">-</span><span class="n">sn</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">sn</span><span class="p">),</span> <span class="n">sn</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%15s</span><span class="s1"> </span><span class="si">%15s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;Mean&#39;</span><span class="p">,</span> <span class="s1">&#39;Std. Deviation&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="mi">31</span> <span class="o">*</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">npr</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">sn</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">i</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10_000</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">sn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">sn</span><span class="p">,</span> <span class="o">-</span><span class="n">sn</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%15.12f</span><span class="s1"> </span><span class="si">%15.12f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sn</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">sn</span><span class="o">.</span><span class="n">std</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(10000,)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.842170943040401e-18
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           Mean  Std. Deviation
-------------------------------
 0.000000000000  1.009653753942
-0.000000000000  1.000413716783
 0.000000000000  1.002925061201
-0.000000000000  1.000755212673
 0.000000000000  1.001636910076
-0.000000000000  1.000726758438
-0.000000000000  1.001621265149
 0.000000000000  1.001203722778
-0.000000000000  1.000556669784
-0.000000000000  1.000113464185
-0.000000000000  0.999435175324
-0.000000000000  0.999356961431
-0.000000000000  0.999641436845
-0.000000000000  0.999642768905
-0.000000000000  0.999638303451
</pre></div>
</div>
</div>
</div>
<p><strong>Moment Matching</strong><br>
corrects both the first moment and the second moment<br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sn</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="mi">10_000</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">sn</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">sn</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
<span class="n">sn_new</span> <span class="o">=</span> <span class="p">(</span><span class="n">sn</span> <span class="o">-</span> <span class="n">sn</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">sn</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">sn_new</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">sn_new</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.001165998295162494
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.991255920204605
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-2.3803181647963357e-17
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9999999999999999
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="valuation-of-contingent-claims-options-derivatives-hybrid-instruments">
<h3>Valuation of Contingent Claims (options, derivatives, hybrid instruments)<a class="headerlink" href="#valuation-of-contingent-claims-options-derivatives-hybrid-instruments" title="Permalink to this headline">¶</a></h3>
<p>in a risk-neutral world, the value of a contingent claim is the discounted expected payoff under the risk-neutral (martingale) measure<br>
this is the probability measure that makes all risk factors (stocks, indices, etc.) drift at the riskless short rate, making the discounted processes martingales<br>
according to the Fundamental Theory of Asset Pricing, the existence of such a probability measure is equivalent to the absence of arbitrage<br></p>
<p><strong>Option</strong><br>
The right to buy (call option) or sell (put option) a specified financial instrument at a given maturity date (European option), or over a specified time period (American option), at a given price (strike price)<br></p>
<p><strong>Payoff of European Call Option on an index at maturity</strong><br>
$<span class="math notranslate nohighlight">\(
h(S_T) \equiv \text{max}(S_T - K, 0)
\)</span><span class="math notranslate nohighlight">\(
\)</span>S_T<span class="math notranslate nohighlight">\( the index level at maturity date \)</span>T<span class="math notranslate nohighlight">\(&lt;br&gt;
\)</span>K$ the strike price<br></p>
<p><strong>Pricing by Risk-Neutral Expectation</strong><br>
given a–or in complete markets, the–risk-neutral measure for the relevant stochastic process, the price of an option is<br>
$<span class="math notranslate nohighlight">\(
C_0 = e^{-rT} \textbf{E}^Q_0 (h(S_T)) = e^{-rT} \int^{\infty}_0 h(s) q(s) ds
\)</span>$</p>
<p><strong>Risk-Neutral Monte Carlo Estimator for European Call Option</strong><br>
$<span class="math notranslate nohighlight">\(
\begin{align}
\tilde{C_0} &amp;= e^{-rT} \frac{1}{I} \sum_{i = 1}^I h \left( \tilde{S}^i_T \right)
&amp; \text{where}\, \tilde{S}^i_T \,\text{is the}\, T\text{th simulated index level at maturity} \\
\end{align}
\)</span>$</p>
<div class="math notranslate nohighlight">
\[
C_0 = e^{-rT} \frac{1}{I} \sum_I \text{max} (S_T (i) - K, 0)
\]</div>
<p><span class="math notranslate nohighlight">\(S_T(i)\)</span> is the <span class="math notranslate nohighlight">\(i\)</span>th simulated value of the underlying at maturity <span class="math notranslate nohighlight">\(T\)</span> for a total number of simulated path <span class="math notranslate nohighlight">\(I\)</span> with <span class="math notranslate nohighlight">\(i = 1, 2, ..., I\)</span><br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">S0</span>    <span class="o">=</span> <span class="mi">100</span>
<span class="n">r</span>     <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">T</span>     <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">I</span>     <span class="o">=</span> <span class="mi">50_000</span>

<span class="k">def</span> <span class="nf">gbm_mcs_stat</span> <span class="p">(</span><span class="n">K</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Valuation of European call option in Black-Scholes-Merton by Monte Carlo simulation</span>
<span class="sd">    (of index level at maturity)</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    K: float</span>
<span class="sd">        (positive) strike price of the option</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    C0: float</span>
<span class="sd">        estimated present value of European call option</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">sn</span> <span class="o">=</span> <span class="n">gen_sn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
    <span class="c1"># simulate index level at maturity</span>
    <span class="n">ST</span> <span class="o">=</span> <span class="n">S0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">sn</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># calculate payoff at maturity</span>
    <span class="n">hT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">ST</span> <span class="o">-</span> <span class="n">K</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># calculate MCS estimator</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">hT</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">C0</span>

<span class="n">gbm_mcs_stat</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">105</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10.044221852841922
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="mi">50</span> <span class="c1"># the number of time intervals for the discretization</span>

<span class="k">def</span> <span class="nf">gbm_mcs_dyna</span> <span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s1">&#39;call&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Valuation of European options in Black-Scholes-Merton</span>
<span class="sd">    by Monte Carlo simulation (of index level paths)</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    K: float</span>
<span class="sd">        (positive) strike price of the option</span>
<span class="sd">    option: string</span>
<span class="sd">        type of the option to be valued (&#39;call&#39;, &#39;put&#39;)</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    C0: float</span>
<span class="sd">        estimated present value of European call option</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">T</span> <span class="o">/</span> <span class="n">M</span>
    <span class="c1"># simulation of index level paths</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">I</span><span class="p">))</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">S0</span>
    <span class="n">sn</span> <span class="o">=</span> <span class="n">gen_sn</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">S</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="o">*</span> <span class="n">sn</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
    <span class="c1"># case-based calculation of payoff</span>
    <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span>
        <span class="n">hT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">K</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># calculation of MCS estimator</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">hT</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">C0</span>

<span class="n">gbm_mcs_dyna</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">110</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s1">&#39;call&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.950008525028434
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gbm_mcs_dyna</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">110</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s1">&#39;put&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>12.629934942682004
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>how well do these simulation-based valuation approaches perform relative to the benchmark value from the BSM valuation formula?<br>
generate option values/estimates for a range of strike prices using the analytical option pricing formula for European calls<br>
compare the results from the static simulation and dynamic valuation approaches with precise analytical values<br>
all valuation differences are smaller than 1% absolutely, with both positive and negative differences<br>
as a general rule, the quality of the Monte Carlo estimator can be controlled for by adjusting the number of time intervals M used and/or the number of paths I simulated<br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Valuation of European call options in Black-Scholes-Merton model</span>
<span class="c1"># including Vega function and implied volatility estimation</span>

<span class="k">def</span> <span class="nf">bsm_call_value</span> <span class="p">(</span><span class="n">S0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Valuation of European call option in BSM model.</span>
<span class="sd">    Analytical formula.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    S0: float</span>
<span class="sd">        initial stock/index level</span>
<span class="sd">    K: float</span>
<span class="sd">        strike price</span>
<span class="sd">    T: float</span>
<span class="sd">        maturity date (in year fractions)</span>
<span class="sd">    r: float</span>
<span class="sd">        constant risk-free short rate</span>
<span class="sd">    sigma: float</span>
<span class="sd">        volatility factor in diffusion term</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    value: float</span>
<span class="sd">        present value of the European call option</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">exp</span>
    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
    
    <span class="n">S0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">S0</span><span class="p">)</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">S0</span> <span class="o">/</span> <span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">S0</span> <span class="o">/</span> <span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
    <span class="c1"># stats.norm.cdf --&gt; cumulative distribution function for normal distribution</span>
    <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">S0</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-</span> <span class="n">K</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="k">def</span> <span class="nf">bdm_vega</span> <span class="p">(</span><span class="n">S0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Vega of European option in BSM model.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    S0: float</span>
<span class="sd">        initial stock/index level</span>
<span class="sd">    K: float</span>
<span class="sd">        strike price</span>
<span class="sd">    T: float</span>
<span class="sd">        maturity date (in year fractions)</span>
<span class="sd">    r: float</span>
<span class="sd">        constant risk-free short rate</span>
<span class="sd">    sigma: float</span>
<span class="sd">        volatility factor in diffusion term</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    vega: float</span>
<span class="sd">        partial derivative of BSM formula with respect to sigma, i.e. Vega</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log</span><span class="p">,</span> <span class="n">sqrt</span>
    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
    
    <span class="n">S0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">S0</span><span class="p">)</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">S0</span> <span class="o">/</span> <span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
    <span class="n">vega</span> <span class="o">=</span> <span class="n">S0</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vega</span>

<span class="c1"># implied volatility function</span>
<span class="k">def</span> <span class="nf">bsm_call_imp_vol</span> <span class="p">(</span><span class="n">S0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">sigma_est</span><span class="p">,</span> <span class="n">it</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Implied volatility of European call option in BSM model.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    S0: float</span>
<span class="sd">        initial stock/index level</span>
<span class="sd">    K: float</span>
<span class="sd">        strike price</span>
<span class="sd">    T: float</span>
<span class="sd">        maturity date (in year fractions)</span>
<span class="sd">    r: float</span>
<span class="sd">        constant risk-free short rate</span>
<span class="sd">    sigma_est: float</span>
<span class="sd">        estimate of implied volatility</span>
<span class="sd">    it: integer</span>
<span class="sd">        number of iterations</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    sigma_est: float</span>
<span class="sd">        numerically estimated implied volatility</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">it</span><span class="p">):</span>
        <span class="n">sigma_est</span> <span class="o">-=</span> <span class="p">((</span><span class="n">bsm_call_value</span><span class="p">(</span><span class="n">S0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">sigma_est</span><span class="p">)</span> <span class="o">-</span> <span class="n">C0</span><span class="p">)</span> <span class="o">/</span> <span class="n">bsm_vega</span><span class="p">(</span><span class="n">S0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">sigma_est</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">sigma_est</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_res</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dyna_res</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">anal_res</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">k_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">120.1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">npr</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="n">k_list</span><span class="p">:</span>
    <span class="n">stat_res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gbm_mcs_stat</span><span class="p">(</span><span class="n">K</span><span class="p">))</span>
    <span class="n">dyna_res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gbm_mcs_dyna</span><span class="p">(</span><span class="n">K</span><span class="p">))</span>
    <span class="n">anal_res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bsm_call_value</span><span class="p">(</span><span class="n">S0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>
    
<span class="n">stat_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stat_res</span><span class="p">)</span>
<span class="n">dyna_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dyna_res</span><span class="p">)</span>
<span class="n">anal_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">anal_res</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_list</span><span class="p">,</span> <span class="n">anal_res</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;analytical&#39;</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_list</span><span class="p">,</span> <span class="n">stat_res</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;static&#39;</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;European call option value&#39;</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
<span class="n">wi</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">k_list</span> <span class="o">-</span> <span class="n">wi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">anal_res</span> <span class="o">-</span> <span class="n">stat_res</span><span class="p">)</span> <span class="o">/</span> <span class="n">anal_res</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">wi</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;strike&#39;</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;difference in %&#39;</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">125</span><span class="p">);</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Analytical option values vs. Monte Carlo estimators (static simulation)&#39;</span><span class="p">);</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_list</span><span class="p">,</span> <span class="n">anal_res</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;analytical&#39;</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_list</span><span class="p">,</span> <span class="n">dyna_res</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;dynamic&#39;</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;European call option value&#39;</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
<span class="n">wi</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">k_list</span> <span class="o">-</span> <span class="n">wi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">anal_res</span> <span class="o">-</span> <span class="n">dyna_res</span><span class="p">)</span> <span class="o">/</span> <span class="n">anal_res</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">wi</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;strike&#39;</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;difference in %&#39;</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">125</span><span class="p">);</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Analytical option values vs. Monte Carlo estimators (dynamic simulation)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/template_finance_43_0.png" src="../_images/template_finance_43_0.png" />
<img alt="../_images/template_finance_43_1.png" src="../_images/template_finance_43_1.png" />
</div>
</div>
<hr class="docutils" />
<p><strong>Valuation of American Option via Optimal Stopping Problem</strong><br>
an optimal stopping problem has to be solved to come up with a fair value of the option<br>
$<span class="math notranslate nohighlight">\(
V_0 = \underset{r \in \{0, \Delta t, 2 \Delta t, ..., T\}}{\text{sup}} e^{-rT} \textbf{E}^Q_0 (h_{\tau}(S_{\tau}))
\)</span>$</p>
<p><strong>LSM Least-Squares Monte Carlo</strong><br>
Longstaff &amp; Schwartz (2001)<br>
the value of an American/Bermudan option at any given date <span class="math notranslate nohighlight">\(t\)</span> is given as
$<span class="math notranslate nohighlight">\(
V_t(s) = \text{max}(h_t (s), C_t (s))
\)</span><span class="math notranslate nohighlight">\(
where \)</span>C_t (s) = \textbf{E}^Q_t (e^{-r \Delta t} V_{t + \Delta t} (S_{t + \Delta t} | S_t = s)<span class="math notranslate nohighlight">\( is the continuation value of the option given an index level of \)</span>S_t = s$<br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gbm_mcs_amer</span> <span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s1">&#39;call&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Valuation of American option in Black-Scholes-Merton</span>
<span class="sd">    by Monte Carlo simulation by LSM algorithm</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    K: float</span>
<span class="sd">        (positive) strike price of the option</span>
<span class="sd">    option: string</span>
<span class="sd">        type of the option to be valued (&#39;call&#39;, &#39;put&#39;)</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    =======</span>
<span class="sd">    C0: float</span>
<span class="sd">        estimated present value of American call option</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">T</span> <span class="o">/</span> <span class="n">M</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
    <span class="c1"># simulation of index levels</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">I</span><span class="p">))</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">S0</span>
    <span class="n">sn</span> <span class="o">=</span> <span class="n">gen_sn</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">S</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="o">*</span> <span class="n">sn</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
    <span class="c1"># case based calculation of payoff</span>
    <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">S</span> <span class="o">-</span> <span class="n">K</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="n">S</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># LSM algorithm</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">V</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">S</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
        <span class="n">V</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">C</span> <span class="o">&gt;</span> <span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">V</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
    <span class="c1"># MCS estimator</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="n">df</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">C0</span>

<span class="n">gbm_mcs_amer</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s1">&#39;call&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.721705606305353
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gbm_mcs_amer</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s1">&#39;put&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>13.609997625418051
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euro_res</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">amer_res</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">k_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">120.1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="n">k_list</span><span class="p">:</span>
    <span class="n">euro_res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gbm_mcs_dyna</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="s1">&#39;put&#39;</span><span class="p">))</span>
    <span class="n">amer_res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gbm_mcs_amer</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="s1">&#39;put&#39;</span><span class="p">))</span>
<span class="n">euro_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">euro_res</span><span class="p">)</span>
<span class="n">amer_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">amer_res</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_list</span><span class="p">,</span> <span class="n">euro_res</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;European put&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_list</span><span class="p">,</span> <span class="n">amer_res</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;American put&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;call option value&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">wi</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">k_list</span> <span class="o">-</span> <span class="n">wi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">amer_res</span> <span class="o">-</span> <span class="n">euro_res</span><span class="p">)</span> <span class="o">/</span> <span class="n">euro_res</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">wi</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;strike&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;early exercise premium in %&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">125</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/template_finance_48_0.png" src="../_images/template_finance_48_0.png" />
</div>
</div>
<hr class="docutils" />
<p><strong>VaR Value at Risk</strong><br>
limited ability to capture tail risk<br>
a number denoted in currency units (e.g., USD, EUR, JPY) indicating a loss (of a portfolio, a single position, etc.) that is not exceeded with some confidence level (probability) over a given period of time<br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">S0</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">r</span>  <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">/</span> <span class="mi">365</span>
<span class="n">I</span> <span class="o">=</span> <span class="mi">10_000</span>
<span class="c1"># simulate end of period values for the geometric Brownian motion</span>
<span class="n">ST</span> <span class="o">=</span> <span class="n">S0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">npr</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
<span class="c1"># calculate the absolute profits and losses per simulation run and sort the values</span>
<span class="n">R_gbm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">ST</span> <span class="o">-</span> <span class="n">S0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">R_gbm</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;absolute return&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Absolute profits and losses from simulation (geometric Brownian motion)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/template_finance_51_0.png" src="../_images/template_finance_51_0.png" />
</div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="stochastic-processes">
<h1>Stochastic Processes<a class="headerlink" href="#stochastic-processes" title="Permalink to this headline">¶</a></h1>
<p><strong>Stochastic Process</strong><br>
a sequence of random variables<br>
similar to a sequence of repeated simulations of a random variable, but draws are typically not independent but rather depend on the result(s) of the previous draw(s)<br></p>
<p><strong>Markov Property</strong><br>
“tomorrow’s value of the simulated process only depends on today’s state of the process, and not any other more “historic” state or even the whole path history”<br>
the process is called memoryless<br></p>
</div>
<hr class="docutils" />
<div class="section" id="probability-distirbution-functions">
<h1>Probability Distirbution Functions<a class="headerlink" href="#probability-distirbution-functions" title="Permalink to this headline">¶</a></h1>
<p><strong>Beta Distribution</strong><br>
npr.beta(a, b[, size]) over [0, 1]<br></p>
<p><strong>Binomial Distribution</strong><br>
npr.binomial(n, p[, size])<br></p>
<p><strong>Chi Squared Distribution</strong><br>
npr.chisquare(df[, size])<br></p>
<p><strong>Dirichlet Distribution</strong><br>
npr.dirichlet(alpha[, size])<br></p>
<p><strong>Exponential Distribution</strong><br>
npr.exponential([scale, size])<br></p>
<p><strong>F Distribution</strong><br>
npr.f(dfnum, dfden[, size])<br></p>
<p><strong>Gamma Distribution</strong><br>
npr.gamma(shape[, scale, size])<br></p>
<p><strong>Geometric Distribution</strong><br>
npr.geometric(p[, size])<br></p>
<p><strong>Gumbel Distribution</strong><br>
npr.gumbel([loc, scale, size])<br></p>
<p><strong>Hypergeometric Distribution</strong><br>
npr.hypergeometric(ngood, nbad, nsample[, size])<br></p>
<p><strong>Laplace/Double-Exponential Distribution</strong><br>
npr.laplace([loc, scale, size])<br></p>
<p><strong>Logistic Distribution</strong><br>
npr.logistic([loc, scale, size])<br></p>
<p><strong>Log Normal Distribution</strong><br>
npr.lognormal([mean, sigma, size])<br></p>
<p><strong>Logarithmic Series Distribution</strong><br>
npr.logseries(p[, size])<br></p>
<p><strong>Multinomial Distribution</strong><br>
npr.multinomial(n, pvals[, size])<br></p>
<p><strong>Multivariate Normal Distribution</strong><br>
npr.multivariate_normal(mean, cov[, size])<br></p>
<p><strong>Negative Binomial Distribution</strong><br>
npr.negative_binoomial(n, p[, size])<br></p>
<p><strong>Non Central Chi Squared Distribution</strong><br>
npr.noncentral_chisquare(df, nonc[, size])<br></p>
<p><strong>Non Central F Distribution</strong><br>
npr.noncentral_f(dfnum, dfden, nonc[, size])<br></p>
<p><strong>Normal/Gaussian Distribution</strong><br>
npr.normal([loc, scale, size])<br></p>
<p><strong>Pareto II / Lomax Distribution</strong><br>
npr.pareto(a[, size])<br></p>
<p><strong>Poisson Distribution</strong><br>
npr.poisson([lam, size])<br></p>
<p><strong>Power Distribution</strong><br>
npr.power(a[, size]) in [0, 1] with positive exponent a - 1<br></p>
<p><strong>Rayleigh Distribution</strong><br>
npr.rayleigh([scale, size])<br></p>
<p><strong>Standard Cauchy Distribution</strong><br>
npr.standard_cauchy([size]) with mode = 0<br></p>
<p><strong>Standard Exponential Distribution</strong><br>
npr.standard_exponential([size])<br></p>
<p><strong>Standard Gamma Distribution</strong><br>
npr.standard_gamma(shape[, size])<br></p>
<p><strong>Standard Normal Distribution</strong><br>
npr.standard_normal([size]) with mean = 0, stdev = 1<br></p>
<p><strong>Student’s t Distribution</strong><br>
npr.standard_t(df[, size]) with df degrees of freedom<br></p>
<p><strong>Triangular Distribution</strong><br>
npr.triangular(left, mode, right[, size]) over the interval [left, right]<br></p>
<p><strong>Uniform Distribution</strong><br>
npr.uniform([low, high, size])<br></p>
<p>uniform random numbers in the interval [a, b) with shape<br>
npr.rand(shape) * (b - a) + a<br></p>
<p>standard normal distribution<br>
npr.randn(shape)</p>
<p>discrete uniform distribution<br>
npr.randint(low_inclusive, high_exclusive, shape)<br>
npr.random_integers(low_inclusive, high_inclusive, shape)<br></p>
<p>continuous uniform distribution [0, 1)<br>
npr.random_sample(shape)<br>
npr.random(shape)<br>
npr.ranf(shape)<br>
npr.sample(shape)<br></p>
<p>uniform or nonuniform<br>
npr.choice(list, shape, probabilities)<br></p>
<p><strong>Von Mises Distribution</strong><br>
npr.vonmises(mu, kappa[, size])<br></p>
<p><strong>Wald / Inverse Gaussian Distribution</strong><br>
npr.wald(mean, scale[, size])<br></p>
<p><strong>Weibull Distribution</strong><br>
npr.weibull(a[, size])<br></p>
<p><strong>Zipf Distribution</strong><br>
npr.zipf(a[, size])<br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualizing NumPy distribution functions</span>

<span class="n">sample_size</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">rn1</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">sample_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">rn2</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span>
<span class="n">rn3</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">sample_size</span><span class="p">)</span>
<span class="n">rn4</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">sample_size</span><span class="p">)</span>
<span class="n">rn5</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">sample_size</span><span class="p">)</span>              <span class="c1"># mean = 0, std = 1</span>
<span class="n">rn6</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span>              <span class="c1"># mean = 100, std = 20</span>
<span class="n">rn7</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">chisquare</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">)</span>       <span class="c1"># 0.5 degrees of freedom</span>
<span class="n">rn8</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">lam</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">),</span> <span class="p">(</span><span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">),</span> <span class="p">(</span><span class="n">ax5</span><span class="p">,</span> <span class="n">ax6</span><span class="p">),</span> <span class="p">(</span><span class="n">ax7</span><span class="p">,</span> <span class="n">ax8</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rn1</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;rand&#39;</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rn2</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;randint&#39;</span><span class="p">);</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rn3</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">);</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">);</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">);</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rn4</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;choice&#39;</span><span class="p">);</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rn5</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">);</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;standard normal&#39;</span><span class="p">);</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">);</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rn6</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">);</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;normal(100, 20)&#39;</span><span class="p">);</span>
<span class="n">ax7</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rn7</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">);</span>
<span class="n">ax7</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;chi square&#39;</span><span class="p">);</span>
<span class="n">ax7</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">);</span>
<span class="n">ax8</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rn8</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">);</span>
<span class="n">ax8</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Poisson&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/template_finance_92_0.png" src="../_images/template_finance_92_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_size</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">rn1</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">sample_size</span><span class="p">)</span>
<span class="n">rn2</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">)</span>
<span class="n">rn3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rn2</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rn1</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Standard Normal&#39;</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">rn1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">rn1</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rn2</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Log Normal&#39;</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">rn2</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">rn2</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rn3</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Normalized Log Normal&#39;</span><span class="p">);</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">rn3</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">);</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">rn3</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">);</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/template_finance_93_0.png" src="../_images/template_finance_93_0.png" />
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="python-for-algorithmic-trading">
<h1>Python for Algorithmic Trading<a class="headerlink" href="#python-for-algorithmic-trading" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">exp</span><span class="p">,</span> <span class="n">sqrt</span>

<span class="n">S0</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">r</span>  <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">T</span>  <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1_000_000</span><span class="p">):</span>
    <span class="n">ST</span> <span class="o">=</span> <span class="n">S0</span> <span class="o">*</span> <span class="n">exp</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ST</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 1.1 s, sys: 39.7 ms, total: 1.14 s
Wall time: 1.16 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">S0</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">r</span>  <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">T</span>  <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.2</span>

<span class="n">ST</span> <span class="o">=</span> <span class="n">S0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="mi">1_000_000</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 42.7 ms, sys: 6.85 ms, total: 49.6 ms
Wall time: 49 ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="n">mpl</span><span class="p">,</span> <span class="n">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn&#39;</span><span class="p">)</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;serif&#39;</span>

<span class="kn">import</span> <span class="nn">configparser</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Dave Friedman<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>